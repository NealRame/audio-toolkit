set(AUDIO_GENERATED_INCLUDES_DIRECTORY ${GENERATED_INCLUDES_DIRECTORY}/audio)

file(MAKE_DIRECTORY ${AUDIO_GENERATED_INCLUDES_DIRECTORY})
file(GLOB_RECURSE HEADERS RELATIVE "${CMAKE_CURRENT_SOURCE_DIR}" "*.h")
file(GLOB_RECURSE SOURCES RELATIVE "${CMAKE_CURRENT_SOURCE_DIR}" "*.cc")

foreach(HEADER ${HEADERS})
	get_filename_component(NAME ${HEADER} NAME_WE)
	get_filename_component(DIRNAME ${HEADER} DIRECTORY)

	set(DIRNAME ${AUDIO_GENERATED_INCLUDES_DIRECTORY}/${DIRNAME})
	string(REGEX REPLACE "^audio_(.*)$" "\\1" NAME ${NAME})

	file(MAKE_DIRECTORY ${AUDIO_GENERATED_INCLUDES_DIRECTORY}/${DIRNAME})

	execute_process(COMMAND 
		date +%Y/%m/%d\ -\ %H:%M:%S
		OUTPUT_VARIABLE DATE
	)

	file(WRITE  ${DIRNAME}/${NAME}
		"// ☠ DO NOT EDIT ☠\n"
		"// Generated file - ${DATE}"
		"#include \"${CMAKE_CURRENT_SOURCE_DIR}/${HEADER}\""
	)
endforeach()

add_library (libaudiotoolkit SHARED ${SOURCES})
